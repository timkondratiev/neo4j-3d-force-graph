<head>
    <style>
        body {
            margin: 0;
        }
    </style>

    <script src="//unpkg.com/3d-force-graph"></script>
    <!-- <script src="SBOM.js"></script> -->
    <!--<script src="../../dist/3d-force-graph.js"></script>-->
</head>

<body>
    <div id="3d-graph"></div>

    <script>
        // Random tree
        const N = 300;
        // const gData = {
        //     nodes: [...Array(N).keys()].map(i => ({ id: i })),
        //     links: [...Array(N).keys()]
        //         .filter(id => id)
        //         .map(id => ({
        //             source: id,
        //             target: Math.round(Math.random() * (id - 1))
        //         }))
        // };

        fetch('SBOM.json')
            .then(res => res.json())
            .then(out => {
                sbom = out
                const gData = {
                    nodes: sbom.dependencies.map((module, i) => ({ id: module.ref, name: "" })),
                    links: []
                    // links: sbom.dependencies.filter(dep => dep.dependsOn).map(dep => ({source: dep.ref, target: dep.dependsOn}))
                }


                for (let module of sbom.dependencies) {
                    if (!module.dependsOn) continue
                    for (let j of module.dependsOn) {
                        gData.links.push({ source: module.ref, target: j })
                    }
                }

                console.log(gData)

                const Graph = ForceGraph3D()
                    (document.getElementById('3d-graph'))
                    .graphData(gData);
            }
            )
            .catch(err => { throw err });



    </script>
</body>